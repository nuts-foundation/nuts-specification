@startuml
actor Holder
box "Verifier Nuts Node" #LightBlue
participant HttpProxy as "Http Proxy (mTLS)"
participant Server as "Http Listener"
participant InboundHandler
participant OutboundHandler
end box
box "Verifier Business App" #LightGrey
participant CredentialProcessor
end box
actor Issuer

Holder -> HttpProxy ++ : POST ( body: JSON Web Message )
HttpProxy -> Server ++ : proxy_pass inbound
deactivate HttpProxy
Server -> Server ++ : Route to controller
Server ->> InboundHandler ++ : Handle inbound message
Server --> Holder -- : 200 OK
deactivate Server

InboundHandler -> InboundHandler ++ : Verify Presentation
InboundHandler -> Holder : GET /.well-known/did.json
return Presentation Accepted

loop Embedded Verifiable Credentials

    InboundHandler ->> InboundHandler ++ : Verify Credentials
    InboundHandler -> Issuer : GET /.well-known/did.json
    InboundHandler -> Issuer : GET /revocation/<credential id>
    return Credential Accepted

    InboundHandler ->> CredentialProcessor ++ : Process Credential
    deactivate InboundHandler

    CredentialProcessor -> Server ++ : POST outbound ( body: response)
    Server -> Server ++ : Route to controller
    Server ->> OutboundHandler ++ : Handle outbound message
    Server --> CredentialProcessor -- : 200 OK
    deactivate CredentialProcessor
    deactivate Server

    OutboundHandler -> Holder : POST ( body: JSON Web Message )
    Holder --> OutboundHandler : 200 OK
    deactivate OutboundHandler

end
@enduml